# -------------------------------------------------------------
# Base image
# -------------------------------------------------------------
FROM python:3.12-slim

# -------------------------------------------------------------
# System dependencies
# -------------------------------------------------------------
RUN apt-get update && apt-get install -y \
    git \
    ffmpeg \
    libsm6 \
    libxext6 \
    && rm -rf /var/lib/apt/lists/*

# -------------------------------------------------------------
# Workspace
# -------------------------------------------------------------
WORKDIR /workspace
COPY . /workspace

# -------------------------------------------------------------
# Python dependencies
# -------------------------------------------------------------
RUN pip install --upgrade pip
RUN pip install -r requirements.txt

# -------------------------------------------------------------
# Make backend/ and frontend/ importable
# -------------------------------------------------------------
ENV PYTHONPATH="/workspace"

# -------------------------------------------------------------
# Hugging Face exposes ONLY this port
# -------------------------------------------------------------
ENV PORT=7860

# -------------------------------------------------------------
# Start unified ASGI app
# -------------------------------------------------------------
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "7860"]